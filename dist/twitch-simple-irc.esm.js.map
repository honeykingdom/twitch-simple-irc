{"version":3,"file":"twitch-simple-irc.esm.js","sources":["../src/utils.ts","../src/parse.ts","../src/normalize.ts","../src/client.ts","../src/types.ts"],"sourcesContent":["import tekko from 'tekko';\n\nexport const getRandomUsername = (): string => {\n  const randomSuffix = Math.floor(Math.random() * 100000)\n    .toString()\n    .padStart(5, '0');\n  return `justinfan${randomSuffix}`;\n};\n\nexport const getIsAction = (message: string): boolean =>\n  message.startsWith('\\u0001ACTION ') && message.endsWith('\\u0001');\n\nexport const normalizeActionMessage = (message: string): string =>\n  message.slice(8, -1);\n\nexport const getChannelFromMessage = (message: tekko.Message): string =>\n  message.middle[0].slice(1);\n\nexport const isNode = !!(\n  typeof process !== 'undefined' &&\n  process.versions &&\n  process.versions.node\n);\n","import tekko from 'tekko';\nimport { Emotes, BadgeInfo, Badges, TagType } from './types';\n\nconst booleanMessageTags = [\n  'mod',\n  'emote-only',\n  'r9k',\n  'rituals',\n  'subs-only',\n  'msg-param-should-share-streak',\n];\n\nconst numberMessageTags = [\n  'tmi-sent-ts',\n  'bits',\n  'ban-duration',\n  'msg-param-cumulative-months',\n  'msg-param-months',\n  'msg-param-promo-gift-total',\n  'msg-param-streak-months',\n  'msg-param-viewerCount',\n  'msg-param-threshold',\n];\n\nconst tagNamesMap: Record<string, string> = {\n  'badge-info': 'badgeInfo',\n  'display-name': 'displayName',\n  'emote-sets': 'emoteSets',\n  'room-id': 'roomId',\n  'tmi-sent-ts': 'tmiSentTs',\n  'user-id': 'userId',\n  'target-msg-id': 'targetMsgId',\n  'target-user-id': 'targetUserId',\n  'msg-id': 'msgId',\n  'system-msg': 'systemMsg',\n  'emote-only': 'emoteOnly',\n  'followers-only': 'followersOnly',\n  'subs-only': 'subsOnly',\n  'ban-duration': 'banDuration',\n  'message-id': 'messageId',\n  'thread-id': 'threadId',\n  'msg-param-cumulative-months': 'msgParamCumulativeMonths',\n  'msg-param-displayName': 'msgParamDisplayName',\n  'msg-param-login': 'msgParamLogin',\n  'msg-param-months': 'msgParamMonths',\n  'msg-param-promo-gift-total': 'msgParamPromoGiftTotal',\n  'msg-param-promo-name': 'msgParamPromoName',\n  'msg-param-recipient-display-name': 'msgParamRecipientDisplayName',\n  'msg-param-recipient-id': 'msgParamRecipientId',\n  'msg-param-recipient-user-name': 'msgParamRecipientUserName',\n  'msg-param-sender-login': 'msgParamSenderLogin',\n  'msg-param-sender-name': 'msgParamSenderName',\n  'msg-param-should-share-streak': 'msgParamShouldShareStreak',\n  'msg-param-streak-months': 'msgParamStreakMonths',\n  'msg-param-sub-plan': 'msgParamSubPlan',\n  'msg-param-sub-plan-name': 'msgParamSubPlanName',\n  'msg-param-viewerCount': 'msgParamViewerCount',\n  'msg-param-ritual-name': 'msgParamRitualName',\n  'msg-param-threshold': 'msgParamThreshold',\n};\n\nconst depricatedMessageTags = ['subscriber', 'turbo', 'user-type'];\n\nconst parseMessageEmotes = (raw: string = ''): Emotes => {\n  if (!raw) return {};\n\n  return raw.split('/').reduce((acc, emote) => {\n    const [id, indexes] = emote.split(':');\n\n    return {\n      ...acc,\n      [id]: indexes.split(',').map((index) => {\n        const [start, end] = index.split('-');\n\n        return {\n          start: Number.parseInt(start, 10),\n          end: Number.parseInt(end, 10),\n        };\n      }),\n    };\n  }, {});\n};\n\nconst parseBadges = (data: string = ''): BadgeInfo | Badges => {\n  if (!data) return {};\n\n  return data.split(',').reduce((acc, badge) => {\n    const [name, value] = badge.split('/');\n\n    return {\n      ...acc,\n      [name]: value,\n    };\n  }, {});\n};\n\nconst normalizeTagValue = (name: string, value: string): TagType => {\n  if (name === 'emotes') return parseMessageEmotes(value);\n  if (name === 'badges') return parseBadges(value);\n  if (name === 'badge-info') return parseBadges(value);\n\n  if (name === 'followers-only') {\n    let followersOnly: boolean | number = false;\n    if (value === '-1') {\n      followersOnly = false;\n    } else if (value === '0') {\n      followersOnly = true;\n    } else if (typeof value === 'string') {\n      followersOnly = parseInt(value, 10);\n    }\n    return followersOnly;\n  }\n\n  if (name === 'slow') {\n    let slow: boolean | number = false;\n    if (value === '0') {\n      slow = false;\n    } else if (typeof value === 'string') {\n      slow = parseInt(value, 10);\n    }\n    return slow;\n  }\n\n  if (booleanMessageTags.includes(name)) return value === '1';\n  if (numberMessageTags.includes(name)) return parseInt(value, 10);\n\n  if (typeof value === 'string') {\n    return value.replace('\\\\s', ' ');\n  }\n\n  return value;\n};\n\nexport const parseMessageTags = (\n  data?: tekko.MessageTags,\n): Record<string, TagType> => {\n  if (!data) {\n    return {};\n  }\n\n  return Object.entries(data).reduce((acc, [key, value]) => {\n    if (depricatedMessageTags.includes(key)) {\n      return acc;\n    }\n\n    const newKey = tagNamesMap[key] || key;\n\n    return {\n      ...acc,\n      [newKey]: normalizeTagValue(key, value as string),\n    };\n  }, {});\n};\n","import tekko from 'tekko';\n\nimport {\n  TekkoMessage,\n  GlobalUserStateEvent,\n  GlobalUserStateTags,\n  MessageEvent,\n  MessageTags,\n  WhisperEvent,\n  WhisperTags,\n} from './types';\nimport {\n  getIsAction,\n  normalizeActionMessage,\n  getChannelFromMessage,\n} from './utils';\nimport { parseMessageTags } from './parse';\n\nexport const normalizeChatMessage = (data: TekkoMessage): MessageEvent => {\n  const { raw, trailing, tags, prefix } = data;\n  const { name } = prefix as tekko.MessagePrefix;\n  const isAction = getIsAction(trailing);\n\n  return {\n    raw,\n    message: isAction ? normalizeActionMessage(trailing) : trailing,\n    channel: getChannelFromMessage(data),\n    user: name,\n    get tags() {\n      return (parseMessageTags(tags) as unknown) as MessageTags;\n    },\n    isAction,\n  };\n};\n\nexport const normalizeGlobalUserState = ({\n  raw,\n  tags,\n}: TekkoMessage): GlobalUserStateEvent => ({\n  raw,\n  get tags() {\n    return parseMessageTags(tags) as GlobalUserStateTags;\n  },\n});\n\nexport const normalizeState = (data: TekkoMessage) => {\n  const { raw, tags } = data;\n\n  return {\n    raw,\n    channel: getChannelFromMessage(data),\n    get tags() {\n      return parseMessageTags(tags);\n    },\n  };\n};\n\nexport const normalizeCommand = (data: TekkoMessage) => {\n  const { raw, trailing, tags } = data;\n\n  return {\n    raw,\n    message: trailing,\n    channel: getChannelFromMessage(data),\n    get tags() {\n      return parseMessageTags(tags);\n    },\n  };\n};\n\nexport const normalizeWhisper = ({\n  raw,\n  trailing,\n  tags,\n  prefix,\n  middle: [channel],\n}: TekkoMessage): WhisperEvent => {\n  const { name } = prefix as tekko.MessagePrefix;\n\n  return {\n    raw,\n    message: trailing,\n    channel,\n    user: name,\n    get tags() {\n      return (parseMessageTags(tags) as unknown) as WhisperTags;\n    },\n  };\n};\n","import tls from 'tls';\nimport { Socket } from 'net';\nimport { EventEmitter } from 'events';\nimport * as tekko from 'tekko';\n\nimport {\n  TekkoMessage,\n  MessageEvent,\n  GlobalUserStateEvent,\n  GlobalUserStateTags,\n  UserStateEvent,\n  UserStateTags,\n  RoomStateEvent,\n  RoomStateTags,\n  ClearChatEvent,\n  ClearMessageEvent,\n  HostTargetEvent,\n  NoticeEvent,\n  UserNoticeEvent,\n  WhisperEvent,\n  JoinEvent,\n  PartEvent,\n  PingEvent,\n} from './types';\nimport { isNode, getChannelFromMessage, getRandomUsername } from './utils';\nimport {\n  normalizeChatMessage,\n  normalizeState,\n  normalizeCommand,\n  normalizeWhisper,\n  normalizeGlobalUserState,\n} from './normalize';\n\nexport enum Commands {\n  REPLY001 = '001',\n  PING = 'PING',\n  PONG = 'PONG',\n  JOIN = 'JOIN',\n  PART = 'PART',\n  PRIVMSG = 'PRIVMSG',\n  NOTICE = 'NOTICE',\n  USERNOTICE = 'USERNOTICE',\n  GLOBALUSERSTATE = 'GLOBALUSERSTATE',\n  USERSTATE = 'USERSTATE',\n  ROOMSTATE = 'ROOMSTATE',\n  CLEARCHAT = 'CLEARCHAT',\n  CLEARMSG = 'CLEARMSG',\n  HOSTTARGET = 'HOSTTARGET',\n  WHISPER = 'WHISPER',\n}\n\nconst RECONNECT_BASE_INTERVAL = 2000;\nconst MAX_RECONNECT_INTERVAL = 60 * 1000;\n\ninterface ClientOptions {\n  name?: string;\n  auth?: string;\n  secure?: boolean;\n  reconnect?: boolean;\n}\n\ninterface Channels {\n  [channel: string]: {\n    userState: UserStateTags;\n    roomState: RoomStateTags;\n  };\n}\n\ntype Listener<T> = (data: T) => void;\n\nexport interface Client {\n  on(event: 'connect', listener: () => void): this;\n  on(event: 'disconnect', listener: (error?: Error) => void): this;\n  on(event: 'register', listener: () => void): this;\n  on(event: 'message', listener: Listener<MessageEvent>): this;\n  on(event: 'notice', listener: Listener<NoticeEvent>): this;\n  on(event: 'usernotice', listener: Listener<UserNoticeEvent>): this;\n  on(event: 'whisper', listener: Listener<WhisperEvent>): this;\n  on(event: 'globaluserstate', listener: Listener<GlobalUserStateEvent>): this;\n  on(event: 'userstate', listener: Listener<UserStateEvent>): this;\n  on(event: 'roomstate', listener: Listener<RoomStateEvent>): this;\n  on(event: 'join', listener: Listener<JoinEvent>): this;\n  on(event: 'part', listener: Listener<PartEvent>): this;\n  on(event: 'clearchat', listener: Listener<ClearChatEvent>): this;\n  on(event: 'clearmessage', listener: Listener<ClearMessageEvent>): this;\n  on(event: 'hosttarget', listener: Listener<HostTargetEvent>): this;\n  on(event: 'ping', listener: Listener<PingEvent>): this;\n  on(event: 'error', listener: (error: Error) => void): this;\n\n  emit(event: 'connect'): boolean;\n  emit(event: 'disconnect', error?: Error): boolean;\n  emit(event: 'register'): boolean;\n  emit(event: 'message', data: MessageEvent): boolean;\n  emit(event: 'notice', data: NoticeEvent): boolean;\n  emit(event: 'usernotice', data: UserNoticeEvent): boolean;\n  emit(event: 'whisper', data: WhisperEvent): boolean;\n  emit(event: 'globaluserstate', data: GlobalUserStateEvent): boolean;\n  emit(event: 'userstate', data: UserStateEvent): boolean;\n  emit(event: 'roomstate', data: RoomStateEvent): boolean;\n  emit(event: 'join', data: JoinEvent): boolean;\n  emit(event: 'part', data: PartEvent): boolean;\n  emit(event: 'clearchat', data: ClearChatEvent): boolean;\n  emit(event: 'clearmessage', data: ClearMessageEvent): boolean;\n  emit(event: 'hosttarget', data: HostTargetEvent): boolean;\n  emit(event: 'ping', data: PingEvent): boolean;\n  emit(event: 'error', error: Error): boolean;\n}\n\nexport class Client extends EventEmitter {\n  socket: WebSocket | Socket | null = null;\n\n  options: ClientOptions;\n\n  globalUserState: GlobalUserStateTags | null = null;\n\n  channels: Channels = {};\n\n  private _connected = false;\n\n  private _connecting = false;\n\n  private _registered = false;\n\n  private _reconnectInterval = RECONNECT_BASE_INTERVAL;\n\n  constructor(options: ClientOptions | null | undefined = {}) {\n    super();\n    this.options = { secure: true, reconnect: true, ...options };\n  }\n\n  async connect(): Promise<void> {\n    const connection = isNode\n      ? this._connectInNode()\n      : this._connectInBrowser();\n\n    await connection;\n\n    return this._register();\n  }\n\n  disconnect() {\n    if (!this._connected) return;\n\n    if (isNode) {\n      (this.socket as Socket).destroy();\n    } else {\n      (this.socket as WebSocket).close();\n    }\n\n    this.socket = null;\n    this._connected = false;\n    this._connecting = false;\n    this._registered = false;\n\n    this.emit('disconnect');\n  }\n\n  reconnect() {\n    if (this._connected) return;\n\n    const interval = Math.min(MAX_RECONNECT_INTERVAL, this._reconnectInterval);\n\n    setTimeout(async () => {\n      await this.connect();\n\n      if (this._connected && this._registered) {\n        this._reconnectInterval = RECONNECT_BASE_INTERVAL;\n\n        Object.keys(this.channels).map((channel) => this.join(channel));\n      } else {\n        this._reconnectInterval *= 2;\n        this.reconnect();\n      }\n    }, interval);\n  }\n\n  receiveRaw(rawData: string) {\n    const data = rawData.trim().split('\\r\\n');\n\n    data.forEach((line) => this._handleMessage(line));\n  }\n\n  sendRaw(message: string): boolean {\n    if (this.socket === null || !message) {\n      return false;\n    }\n\n    if (isNode) {\n      (this.socket as Socket).write(`${message}\\r\\n`);\n    } else {\n      (this.socket as WebSocket).send(message);\n    }\n\n    return true;\n  }\n\n  say(channel: string, message: string): boolean {\n    if (!message) return false;\n\n    const ircMessage = tekko.format({\n      command: Commands.PRIVMSG,\n      middle: [`#${channel}`],\n      trailing: message,\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  sendCommand(\n    channel: string,\n    command: string,\n    params: string | Array<string> = '',\n  ): boolean {\n    const commandParams = Array.isArray(params) ? params.join(' ') : params;\n    const ircMessage = tekko.format({\n      command: Commands.PRIVMSG,\n      middle: [`#${channel}`],\n      trailing: `/${command} ${commandParams}`,\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  join(channel: string): boolean {\n    if (!this._registered) return false;\n\n    const ircMessage = tekko.format({\n      command: Commands.JOIN,\n      middle: [`#${channel}`],\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  part(channel: string): boolean {\n    if (!this._registered) return false;\n\n    const ircMessage = tekko.format({\n      command: Commands.PART,\n      middle: [`#${channel}`],\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  _handleMessage(raw: string) {\n    const data: TekkoMessage = tekko.parse(raw) as TekkoMessage;\n    data.raw = raw;\n    const { command } = data;\n\n    if (command === Commands.PING) {\n      this.sendRaw(`${Commands.PONG} :tmi.twitch.tv`);\n      this.emit('ping', { raw });\n\n      return;\n    }\n\n    if (command === Commands.REPLY001) {\n      this.options.name = data.middle[0];\n      this._registered = true;\n\n      this.emit('register');\n\n      return;\n    }\n\n    if (command === Commands.PRIVMSG) {\n      const eventData = normalizeChatMessage(data);\n\n      this.emit('message', eventData);\n\n      return;\n    }\n\n    if (command === Commands.USERSTATE) {\n      const channel = getChannelFromMessage(data);\n      const eventData = normalizeState(data) as UserStateEvent;\n\n      this._updateUserState(channel, eventData.tags);\n      this.emit('userstate', eventData);\n\n      return;\n    }\n\n    if (command === Commands.JOIN) {\n      const channel = getChannelFromMessage(data);\n      const eventData = { channel } as JoinEvent;\n\n      this.emit('join', eventData);\n\n      return;\n    }\n\n    if (command === Commands.PART) {\n      const channel = getChannelFromMessage(data);\n      const eventData = { channel } as PartEvent;\n\n      this.emit('part', eventData);\n\n      return;\n    }\n\n    if (command === Commands.ROOMSTATE) {\n      const channel = getChannelFromMessage(data);\n      const eventData = (normalizeState(data) as unknown) as RoomStateEvent;\n\n      this._updateRoomState(channel, eventData.tags);\n      this.emit('roomstate', eventData);\n\n      return;\n    }\n\n    if (command === Commands.NOTICE) {\n      const eventData = normalizeCommand(data) as NoticeEvent;\n\n      this.emit('notice', eventData);\n\n      return;\n    }\n\n    if (command === Commands.USERNOTICE) {\n      const eventData = (normalizeCommand(data) as unknown) as UserNoticeEvent;\n\n      this.emit('usernotice', eventData);\n\n      return;\n    }\n\n    if (command === Commands.CLEARCHAT) {\n      const eventData = normalizeCommand(data) as ClearChatEvent;\n\n      this.emit('clearchat', eventData);\n\n      return;\n    }\n\n    if (command === Commands.CLEARMSG) {\n      const eventData = normalizeCommand(data) as ClearMessageEvent;\n\n      this.emit('clearmessage', eventData);\n\n      return;\n    }\n\n    if (command === Commands.HOSTTARGET) {\n      const eventData = normalizeCommand(data) as HostTargetEvent;\n\n      this.emit('hosttarget', eventData);\n\n      return;\n    }\n\n    if (command === Commands.WHISPER) {\n      const eventData = normalizeWhisper(data);\n\n      this.emit('whisper', eventData);\n\n      return;\n    }\n\n    if (command === Commands.GLOBALUSERSTATE) {\n      const eventData = normalizeGlobalUserState(data);\n\n      this._updateGlobalUserState(eventData.tags);\n      this.emit('globaluserstate', eventData);\n\n      return;\n    }\n  }\n\n  _connectInNode(): Promise<void> {\n    const host = 'irc.chat.twitch.tv';\n    const port = this.options.secure ? 6697 : 6667;\n\n    return new Promise<void>((resolve, reject) => {\n      this._connecting = true;\n\n      const handleConnect = () => {\n        this._connecting = false;\n        this._connected = true;\n        this.emit('connect');\n        resolve();\n      };\n\n      if (this.options.secure) {\n        this.socket = tls.connect(port, host, {}, handleConnect);\n      } else {\n        this.socket = new Socket();\n        this.socket.connect(port, host, handleConnect);\n      }\n\n      this.socket.on('error', (error: Error) => {\n        this._connected = false;\n        this._connecting = false;\n        this.emit('disconnect', error);\n\n        reject(error);\n\n        if (this.options.reconnect) {\n          this.reconnect();\n        }\n      });\n      this.socket.on('data', (data: Buffer) => {\n        this.receiveRaw(data.toString());\n      });\n      this.socket.on('close', () => {\n        this._connected = false;\n        this._connecting = false;\n        this._registered = false;\n        this.emit('disconnect');\n      });\n    });\n  }\n\n  _connectInBrowser(): Promise<void> {\n    const url = this.options.secure\n      ? 'wss://irc-ws.chat.twitch.tv:443'\n      : 'ws://irc-ws.chat.twitch.tv:80';\n\n    return new Promise<void>((resolve, reject) => {\n      this._connecting = true;\n      this.socket = new WebSocket(url);\n\n      this.socket.onopen = () => {\n        this._connected = true;\n        this._connecting = false;\n        this.emit('connect');\n        resolve();\n      };\n      this.socket.onmessage = ({ data }) => this.receiveRaw(data);\n      this.socket.onerror = () => {};\n      this.socket.onclose = ({ wasClean, code, reason }) => {\n        this.socket = null;\n        this._connected = false;\n        this._connecting = false;\n        this._registered = false;\n\n        if (wasClean) {\n          this.emit('disconnect');\n        } else {\n          const error = new Error(`[${code}] ${reason}`);\n          this.emit('disconnect', error);\n          reject(error);\n        }\n\n        if (this.options.reconnect) {\n          this.reconnect();\n        }\n      };\n    });\n  }\n\n  _register(): Promise<void> {\n    if (!this._connected) return Promise.reject();\n    if (this._registered) return Promise.resolve();\n\n    const { name, auth } = this.options;\n\n    const nick = name || getRandomUsername();\n    const pass = auth ? `oauth:${auth}` : 'SCHMOOPIIE';\n\n    this.sendRaw('CAP REQ :twitch.tv/tags twitch.tv/commands');\n    this.sendRaw(`PASS ${pass}`);\n    this.sendRaw(`NICK ${nick}`);\n\n    return new Promise<void>((resolve, reject) => {\n      const handleRegister = () => {\n        resolve();\n        this.off('register', handleRegister);\n      };\n\n      this.on('register', handleRegister);\n\n      setTimeout(() => {\n        reject();\n        this.off('register', handleRegister);\n      }, 10000);\n    });\n  }\n\n  _updateGlobalUserState(globalUserState: GlobalUserStateTags) {\n    this.globalUserState = { ...this.globalUserState, ...globalUserState };\n  }\n\n  _updateUserState(channel: string, userState: UserStateTags) {\n    this.channels = {\n      ...this.channels,\n      [channel]: {\n        ...this.channels[channel],\n        userState,\n      },\n    };\n  }\n\n  _updateRoomState(channel: string, roomState: RoomStateTags) {\n    this.channels = {\n      ...this.channels,\n      [channel]: {\n        ...this.channels[channel],\n        roomState,\n      },\n    };\n  }\n\n  get connected() {\n    return this._connected;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get registered() {\n    return this._registered;\n  }\n}\n\nexport default Client;\n","import tekko from 'tekko';\n\nexport interface TekkoMessage extends tekko.Message {\n  raw: string;\n}\n\nexport interface Emotes {\n  [emoteId: string]: Array<{ start: number; end: number }>;\n}\n\nexport interface BadgeInfo {\n  /**\n   * The exact number of months the user has been a subscriber.\n   */\n  subscriber?: number;\n}\n\nexport interface Badges {\n  admin?: string;\n  bits?: string;\n  broadcaster?: string;\n  global_mod?: string;\n  moderator?: string;\n  subscriber?: string;\n  staff?: string;\n  turbo?: string;\n}\n\nexport type TagType = string | boolean | number | Emotes | BadgeInfo | Badges;\n\ninterface ATags {\n  /**\n   * Metadata related to the chat badges in the `badges` tag.\n   */\n  badgeInfo: BadgeInfo;\n\n  /**\n   * List of chat badges and the version of each badge.\n   * Many badges have only 1 version, but some badges have different versions (images), depending on how long you hold the badge status; e.g., `subscriber`.\n   */\n  badges: Badges;\n\n  /**\n   * Hexadecimal RGB color code; the empty string if it is never set.\n   */\n  color: string;\n\n  /**\n   * The user’s display name, escaped as described in the IRCv3 spec. This is empty if it is never set.\n   */\n  displayName: string;\n\n  /**\n   * Your emote set, a comma-separated list of emote sets.\n   */\n  emoteSets: string;\n\n  /**\n   * Information to replace text in the message with emote images. This can be empty.\n   */\n  emotes: Emotes;\n\n  /**\n   * A unique ID for the message.\n   */\n  id: string;\n\n  /**\n   * `true` if the user has a moderator badge; otherwise, `false`.\n   */\n  mod: boolean;\n\n  /**\n   * The channel ID.\n   */\n  roomId: string;\n\n  /**\n   * Timestamp when the server received the message.\n   */\n  tmiSentTs: number;\n\n  /**\n   * The user’s ID.\n   */\n  userId: string;\n}\n\nexport interface MessageTags\n  extends Pick<\n    ATags,\n    | 'badgeInfo'\n    | 'badges'\n    | 'color'\n    | 'displayName'\n    | 'emotes'\n    | 'id'\n    | 'mod'\n    | 'roomId'\n    | 'tmiSentTs'\n    | 'userId'\n  > {\n  /**\n   * (Sent only for Bits messages) The amount of cheer/Bits employed by the user.\n   */\n  bits?: number;\n}\n\n/**\n * Sends a message to a channel.\n */\nexport interface MessageEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  user: string;\n  tags: MessageTags;\n  isAction: boolean;\n}\n\nexport type GlobalUserStateTags = Pick<\n  ATags,\n  'badgeInfo' | 'badges' | 'color' | 'displayName' | 'emoteSets' | 'userId'\n>;\n\n/**\n * On successful login, provides data about the current logged-in user through IRC tags.\n * It is sent after successfully authenticating (sending a PASS/NICK command).\n */\nexport interface GlobalUserStateEvent {\n  raw: string;\n  tags: GlobalUserStateTags;\n}\n\nexport type UserStateTags = Pick<\n  ATags,\n  'badgeInfo' | 'badges' | 'color' | 'displayName' | 'emoteSets' | 'mod'\n>;\n\n/**\n * Sends user-state data when a user joins a channel or sends a PRIVMSG to a channel.\n */\nexport interface UserStateEvent {\n  raw: string;\n  channel: string;\n  tags: UserStateTags;\n}\n\nexport interface RoomStateTags extends Pick<ATags, 'roomId'> {\n  /**\n   * Emote-only mode. If enabled, only emotes are allowed in chat.\n   */\n  emoteOnly?: boolean;\n\n  /**\n   * Followers-only mode. If enabled, controls which followers can chat.\n   * Valid values:\n   * -1 (disabled),\n   * false (all followers can chat),\n   * non-negative integer (only users following for at least the specified number of minutes can chat).\n   */\n  followersOnly?: boolean | number;\n\n  /**\n   * R9K mode. If enabled, messages with more than 9 characters must be unique.\n   */\n  r9k?: boolean;\n\n  /**\n   * (Not documented)\n   */\n  rituals?: boolean;\n\n  /**\n   * The number of seconds a chatter without moderator privileges must wait between sending messages.\n   */\n  slow?: boolean | number;\n\n  /**\n   * Subscribers-only mode. If enabled, only subscribers and moderators can chat.\n   */\n  subsOnly?: boolean;\n}\n\n/**\n * Sends room-state data when a user joins a channel or a room setting is changed.\n * For a join, the message contains all chat-room settings.\n * For changes, only the relevant tag is sent.\n */\nexport interface RoomStateEvent {\n  raw: string;\n  channel: string;\n  tags: RoomStateTags;\n}\n\n/**\n * Purges all chat messages in a channel, or purges chat messages from a specific user (typically after a timeout or ban).\n */\nexport interface ClearChatEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {\n    /**\n     * Duration of the timeout, in seconds. If omitted, the ban is permanent.\n     */\n    banDuration?: number;\n\n    /**\n     * (Not documented)\n     */\n    roomId: string;\n\n    /**\n     * (Not documented)\n     */\n    targetUserId?: string;\n\n    /**\n     * (Not documented)\n     */\n    tmiSentTs: number;\n  };\n}\n\n/**\n * Removes a single message from a channel. This is triggered by the `/delete <targetMsgId>` command on IRC.\n */\nexport interface ClearMessageEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {\n    /**\n     * Name of the user who sent the message.\n     */\n    login: string;\n\n    /**\n     * UUID of the message.\n     */\n    targetMsgId: string;\n\n    /**\n     * (Not documented)\n     */\n    tmiSentTs: number;\n  };\n}\n\n/**\n * Channel starts or stops host mode.\n */\nexport interface HostTargetEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {};\n}\n\n/**\n * General notices from the server.\n */\nexport interface NoticeEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {\n    /**\n     * A message ID string. Can be used for i18ln.\n     * Valid values: see https://dev.twitch.tv/docs/irc/msg-id\n     */\n    msgId: string;\n  };\n}\n\nexport enum UserNoticeType {\n  sub = 'sub',\n  resub = 'resub',\n  subgift = 'subgift',\n  anonsubgift = 'anonsubgift',\n  submysterygift = 'submysterygift',\n  giftpaidupgrade = 'giftpaidupgrade',\n  rewardgift = 'rewardgift',\n  anongiftpaidupgrade = 'anongiftpaidupgrade',\n  raid = 'raid',\n  unraid = 'unraid',\n  ritual = 'ritual',\n  bitsbadgetier = 'bitsbadgetier',\n}\n\ninterface AUserNoticeTags {\n  /**\n   * (Sent only on sub, resub) The total number of months the user has subscribed.\n   * This is the same as msg-param-months but sent for different types of user notices.\n   */\n  msgParamCumulativeMonths: number;\n\n  /**\n   * (Sent only on raid) The display name of the source user raiding this channel.\n   */\n  msgParamDisplayName: string;\n\n  /**\n   * (Sent on only raid) The name of the source user raiding this channel.\n   */\n  msgParamLogin: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The total number of months the user has subscribed.\n   * This is the same as msg-param-cumulative-months but sent for different types of user notices.\n   */\n  msgParamMonths: number;\n\n  /**\n   * (Sent only on anongiftpaidupgrade, giftpaidupgrade) The number of gifts the gifter has given during the promo indicated by msg-param-promo-name.\n   */\n  msgParamPromoGiftTotal: number;\n\n  /**\n   * (Sent only on anongiftpaidupgrade, giftpaidupgrade) The subscriptions promo, if any, that is ongoing; e.g. Subtember 2018.\n   */\n  msgParamPromoName: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The display name of the subscription gift recipient.\n   */\n  msgParamRecipientDisplayName: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The user ID of the subscription gift recipient.\n   */\n  msgParamRecipientId: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The user name of the subscription gift recipient.\n   */\n  msgParamRecipientUserName: string;\n\n  /**\n   * (Sent only on giftpaidupgrade) The login of the user who gifted the subscription.\n   */\n  msgParamSenderLogin: string;\n\n  /**\n   * (Sent only on giftpaidupgrade) The display name of the user who gifted the subscription.\n   */\n  msgParamSenderName: string;\n\n  /**\n   * (Sent only on sub, resub) Boolean indicating whether users want their streaks to be shared.\n   */\n  msgParamShouldShareStreak: boolean;\n\n  /**\n   * (Sent only on sub, resub) The number of consecutive months the user has subscribed. This is 0 if msg-param-should-share-streak is 0.\n   */\n  msgParamStreakMonths: number;\n\n  /**\n   * (Sent only on sub, resub, subgift, anonsubgift) The type of subscription plan being used.\n   * Valid values: Prime, 1000, 2000, 3000. 1000, 2000, and 3000 refer to the first, second, and third levels of paid subscriptions, respectively (currently $4.99, $9.99, and $24.99).\n   */\n  msgParamSubPlan: string;\n\n  /**\n   * (Sent only on sub, resub, subgift, anonsubgift) The display name of the subscription plan.\n   * This may be a default name or one created by the channel owner.\n   */\n  msgParamSubPlanName: string;\n\n  /**\n   * (Sent only on raid) The number of viewers watching the source channel raiding this channel.\n   */\n  msgParamViewerCount: number;\n\n  /**\n   * (Sent only on ritual) The name of the ritual this notice is for. Valid value: new_chatter.\n   */\n  msgParamRitualName: string;\n\n  /**\n   * (Sent only on bitsbadgetier) The tier of the bits badge the user just earned; e.g. 100, 1000, 10000.\n   */\n  msgParamThreshold: number;\n}\n\ninterface ABaseUserNoticeTags\n  extends Pick<\n    ATags,\n    | 'badgeInfo'\n    | 'badges'\n    | 'color'\n    | 'displayName'\n    | 'emotes'\n    | 'id'\n    | 'mod'\n    | 'roomId'\n    | 'tmiSentTs'\n    | 'userId'\n  > {\n  /**\n   * The name of the user who sent the notice.\n   */\n  login: string;\n\n  /**\n   * The message printed in chat along with this notice.\n   */\n  systemMsg: string;\n}\n\ninterface UserNoticeTagsSub\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamCumulativeMonths'\n      | 'msgParamShouldShareStreak'\n      | 'msgParamStreakMonths'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  /**\n   * The type of notice (not the ID).\n   */\n  msgId: 'sub';\n}\n\ninterface UserNoticeTagsResub\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamCumulativeMonths'\n      | 'msgParamShouldShareStreak'\n      | 'msgParamStreakMonths'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  msgId: 'resub';\n}\n\ninterface UserNoticeTagsSubGift\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamMonths'\n      | 'msgParamRecipientDisplayName'\n      | 'msgParamRecipientId'\n      | 'msgParamRecipientUserName'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  msgId: 'subgift';\n}\n\ninterface UserNoticeTagsAnonSubGift\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamMonths'\n      | 'msgParamRecipientDisplayName'\n      | 'msgParamRecipientId'\n      | 'msgParamRecipientUserName'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  msgId: 'anonsubgift';\n}\n\ninterface UserNoticeTagsSubMysteryGift extends ABaseUserNoticeTags {\n  msgId: 'submysterygift';\n}\n\ninterface UserNoticeTagsGiftPaidUpgrade\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamPromoGiftTotal'\n      | 'msgParamPromoName'\n      | 'msgParamSenderLogin'\n      | 'msgParamSenderName'\n    > {\n  msgId: 'giftpaidupgrade';\n}\n\ninterface UserNoticeTagsAnonGiftPaidUpgrade\n  extends ABaseUserNoticeTags,\n    Pick<AUserNoticeTags, 'msgParamPromoGiftTotal' | 'msgParamPromoName'> {\n  msgId: 'anongiftpaidupgrade';\n}\n\ninterface UserNoticeTagsRewardGift extends ABaseUserNoticeTags {\n  msgId: 'rewardgift';\n}\n\ninterface UserNoticeTagsRaid\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      'msgParamDisplayName' | 'msgParamLogin' | 'msgParamViewerCount'\n    > {\n  msgId: 'raid';\n}\n\ninterface UserNoticeTagsUnraid extends ABaseUserNoticeTags {\n  msgId: 'unraid';\n}\n\ninterface UserNoticeTagsRitual\n  extends ABaseUserNoticeTags,\n    Pick<AUserNoticeTags, 'msgParamRitualName'> {\n  msgId: 'ritual';\n}\n\ninterface UserNoticeTagsBitsBadGetier\n  extends ABaseUserNoticeTags,\n    Pick<AUserNoticeTags, 'msgParamThreshold'> {\n  msgId: 'bitsbadgetier';\n}\n\ntype UserNoticeTags =\n  | UserNoticeTagsSub\n  | UserNoticeTagsResub\n  | UserNoticeTagsSubGift\n  | UserNoticeTagsAnonSubGift\n  | UserNoticeTagsSubMysteryGift\n  | UserNoticeTagsGiftPaidUpgrade\n  | UserNoticeTagsAnonGiftPaidUpgrade\n  | UserNoticeTagsRewardGift\n  | UserNoticeTagsRaid\n  | UserNoticeTagsUnraid\n  | UserNoticeTagsRitual\n  | UserNoticeTagsBitsBadGetier;\n\n/**\n * Sends a notice to the user when any of the following events occurs:\n * - Subscription, resubscription, or gift subscription to a channel.\n * - Incoming raid to a channel.\n *   Raid is a Twitch tool that allows broadcasters to send their viewers to another channel, to help support and grow other members in the community.\n * - Channel ritual.\n *   Many channels have special rituals to celebrate viewer milestones when they are shared.\n *   The rituals notice extends the sharing of these messages to other viewer milestones (initially, a new viewer chatting for the first time).\n */\nexport interface UserNoticeEvent {\n  raw: string;\n  /**\n   * The message. This is omitted if the user did not enter a message.\n   */\n  message: string;\n  channel: string;\n  tags: UserNoticeTags;\n}\n\nexport interface WhisperTags\n  extends Pick<\n    ATags,\n    'badges' | 'color' | 'displayName' | 'emotes' | 'userId'\n  > {\n  /**\n   * (Not documented)\n   */\n  messageId: string;\n\n  /**\n   * (Not documented)\n   */\n  threadId: string;\n}\n\n/**\n * (Not documented)\n */\nexport interface WhisperEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  user: string;\n  tags: WhisperTags;\n}\n\nexport interface PingEvent {\n  raw: string;\n}\n\n/**\n * Join a channel.\n */\nexport interface JoinEvent {\n  raw: string;\n  channel: string;\n  user: string;\n}\n\n/**\n * Depart from a channel.\n */\nexport interface PartEvent {\n  raw: string;\n  channel: string;\n  user: string;\n}\n"],"names":["getRandomUsername","randomSuffix","Math","floor","random","toString","padStart","getIsAction","message","startsWith","endsWith","normalizeActionMessage","slice","getChannelFromMessage","middle","isNode","process","versions","node","booleanMessageTags","numberMessageTags","tagNamesMap","depricatedMessageTags","parseMessageEmotes","raw","split","reduce","acc","emote","id","indexes","map","index","start","end","Number","parseInt","parseBadges","data","badge","name","value","normalizeTagValue","followersOnly","slow","includes","replace","parseMessageTags","Object","entries","key","newKey","normalizeChatMessage","trailing","tags","prefix","isAction","channel","user","normalizeGlobalUserState","normalizeState","normalizeCommand","normalizeWhisper","Commands","RECONNECT_BASE_INTERVAL","MAX_RECONNECT_INTERVAL","Client","options","secure","reconnect","connect","connection","_connectInNode","_connectInBrowser","_register","disconnect","_connected","socket","destroy","close","_connecting","_registered","emit","interval","min","_reconnectInterval","setTimeout","keys","channels","join","receiveRaw","rawData","trim","forEach","line","_handleMessage","sendRaw","write","send","say","ircMessage","tekko","command","PRIVMSG","sendCommand","params","commandParams","Array","isArray","JOIN","part","PART","PING","PONG","REPLY001","eventData","USERSTATE","_updateUserState","ROOMSTATE","_updateRoomState","NOTICE","USERNOTICE","CLEARCHAT","CLEARMSG","HOSTTARGET","WHISPER","GLOBALUSERSTATE","_updateGlobalUserState","host","port","Promise","resolve","reject","handleConnect","tls","Socket","on","error","url","WebSocket","onopen","onmessage","onerror","onclose","wasClean","code","reason","Error","auth","nick","pass","handleRegister","off","globalUserState","userState","roomState","EventEmitter","UserNoticeType"],"mappings":"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"}