"use strict";var e,t=(e=require("tls"))&&"object"==typeof e&&"default"in e?e.default:e,r=require("net"),n=require("events"),s=require("tekko");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var i,o=function(){return"justinfan"+Math.floor(1e5*Math.random()).toString().padStart(5,"0")},m=function(e){return e.startsWith("ACTION ")&&e.endsWith("")},c=function(e){return e.slice(8,-1)},u=function(e){return e.middle[0].slice(1)},d=!("undefined"==typeof process||!process.versions||!process.versions.node),g=["mod","emote-only","r9k","rituals","subs-only","msg-param-should-share-streak"],l=["tmi-sent-ts","bits","ban-duration","msg-param-cumulative-months","msg-param-months","msg-param-promo-gift-total","msg-param-streak-months","msg-param-viewerCount","msg-param-threshold"],p={"badge-info":"badgeInfo","display-name":"displayName","emote-sets":"emoteSets","room-id":"roomId","tmi-sent-ts":"tmiSentTs","user-id":"userId","target-msg-id":"targetMsgId","target-user-id":"targetUserId","msg-id":"msgId","system-msg":"systemMsg","emote-only":"emoteOnly","followers-only":"followersOnly","subs-only":"subsOnly","ban-duration":"banDuration","message-id":"messageId","thread-id":"threadId","msg-param-cumulative-months":"msgParamCumulativeMonths","msg-param-displayName":"msgParamDisplayName","msg-param-login":"msgParamLogin","msg-param-months":"msgParamMonths","msg-param-promo-gift-total":"msgParamPromoGiftTotal","msg-param-promo-name":"msgParamPromoName","msg-param-recipient-display-name":"msgParamRecipientDisplayName","msg-param-recipient-id":"msgParamRecipientId","msg-param-recipient-user-name":"msgParamRecipientUserName","msg-param-sender-login":"msgParamSenderLogin","msg-param-sender-name":"msgParamSenderName","msg-param-should-share-streak":"msgParamShouldShareStreak","msg-param-streak-months":"msgParamStreakMonths","msg-param-sub-plan":"msgParamSubPlan","msg-param-sub-plan-name":"msgParamSubPlanName","msg-param-viewerCount":"msgParamViewerCount","msg-param-ritual-name":"msgParamRitualName","msg-param-threshold":"msgParamThreshold"},h=["subscriber","turbo","user-type"],f=function(e){return void 0===e&&(e=""),e?e.split(",").reduce((function(e,t){var r,n=t.split("/");return a({},e,((r={})[n[0]]=n[1],r))}),{}):{}},v=function(e){return e?Object.entries(e).reduce((function(e,t){var r,n=t[0],s=t[1];return h.includes(n)?e:a({},e,((r={})[p[n]||n]=function(e,t){if("emotes"===e)return void 0===(r=t)&&(r=""),r?r.split("/").reduce((function(e,t){var r,n=t.split(":");return a({},e,((r={})[n[0]]=n[1].split(",").map((function(e){var t=e.split("-"),r=t[1];return{start:Number.parseInt(t[0],10),end:Number.parseInt(r,10)}})),r))}),{}):{};var r;if("badges"===e)return f(t);if("badge-info"===e)return f(t);if("followers-only"===e){var n=!1;return"-1"===t?n=!1:"0"===t?n=!0:"string"==typeof t&&(n=parseInt(t,10)),n}if("slow"===e){var s=!1;return"0"===t?s=!1:"string"==typeof t&&(s=parseInt(t,10)),s}return g.includes(e)?"1"===t:l.includes(e)?parseInt(t,10):"string"==typeof t?t.replace("\\s"," "):t}(n,s),r))}),{}):{}},S=function(e){var t=e.tags;return{raw:e.raw,channel:u(e),get tags(){return v(t)}}},w=function(e){var t=e.tags;return{raw:e.raw,message:e.trailing,channel:u(e),get tags(){return v(t)}}};(i=exports.Commands||(exports.Commands={})).REPLY001="001",i.PING="PING",i.PONG="PONG",i.JOIN="JOIN",i.PART="PART",i.PRIVMSG="PRIVMSG",i.NOTICE="NOTICE",i.USERNOTICE="USERNOTICE",i.GLOBALUSERSTATE="GLOBALUSERSTATE",i.USERSTATE="USERSTATE",i.ROOMSTATE="ROOMSTATE",i.CLEARCHAT="CLEARCHAT",i.CLEARMSG="CLEARMSG",i.HOSTTARGET="HOSTTARGET",i.WHISPER="WHISPER";var R,P=function(e){var n,i;function g(t){var r;return void 0===t&&(t={}),(r=e.call(this)||this).socket=null,r.globalUserState=null,r.channels={},r._connected=!1,r._connecting=!1,r._registered=!1,r.options=a({secure:!0},t),r}i=e,(n=g).prototype=Object.create(i.prototype),n.prototype.constructor=n,n.__proto__=i;var l,p=g.prototype;return p.connect=function(){try{var e=this,t=d?e._connectInNode():e._connectInBrowser();return Promise.resolve(t).then((function(){return e._register()}))}catch(e){return Promise.reject(e)}},p.disconnect=function(){this._connected&&(d?this.socket.destroy():this.socket.close(),this.socket=null,this._connected=!1,this._connecting=!1,this._registered=!1,this.emit("disconnect"))},p.receiveRaw=function(e){var t=this;e.trim().split("\r\n").forEach((function(e){return t._handleMessage(e)}))},p.sendRaw=function(e){return!(null===this.socket||!e||(d?this.socket.write(e):this.socket.send(e),0))},p.say=function(e,t){var r=s.format({command:exports.Commands.PRIVMSG,middle:["#"+e],trailing:t});return this.sendRaw(r)},p.sendCommand=function(e,t,r){void 0===r&&(r="");var n=Array.isArray(r)?r.join(" "):r,a=s.format({command:exports.Commands.PRIVMSG,middle:["#"+e],trailing:"/"+t+" "+n});return this.sendRaw(a)},p.join=function(e){if(!this._registered)return!1;var t=s.format({command:exports.Commands.JOIN,middle:["#"+e]});return this.sendRaw(t)},p.part=function(e){if(!this._registered)return!1;var t=s.format({command:exports.Commands.PART,middle:["#"+e]});return this.sendRaw(t)},p._handleMessage=function(e){var t=s.parse(e);t.raw=e;var r=t.command;if(r===exports.Commands.PING)return this.sendRaw(exports.Commands.PONG+" :tmi.twitch.tv"),void this.emit("ping",{raw:e});if(r===exports.Commands.REPLY001)return this.options.name=t.middle[0],this._registered=!0,void this.emit("register");if(r!==exports.Commands.PRIVMSG){if(r===exports.Commands.USERSTATE){var n=u(t),a=S(t);return this._updateUserState(n,a.tags),void this.emit("userstate",a)}if(r!==exports.Commands.JOIN)if(r!==exports.Commands.PART){if(r===exports.Commands.ROOMSTATE){var i=u(t),o=S(t);return this._updateRoomState(i,o.tags),void this.emit("roomstate",o)}if(r!==exports.Commands.NOTICE)if(r!==exports.Commands.USERNOTICE)if(r!==exports.Commands.CLEARCHAT)if(r!==exports.Commands.CLEARMSG)if(r!==exports.Commands.HOSTTARGET)if(r!==exports.Commands.WHISPER){var d,g;if(r===exports.Commands.GLOBALUSERSTATE){var l=function(e){var t=e.tags;return{raw:e.raw,get tags(){return v(t)}}}(t);return this._updateGlobalUserState(l.tags),void this.emit("globaluserstate",l)}}else{var p=(g=(d=t).tags,{raw:d.raw,message:d.trailing,channel:d.middle[0],user:d.prefix.name,get tags(){return v(g)}});this.emit("whisper",p)}else{var h=w(t);this.emit("hosttarget",h)}else{var f=w(t);this.emit("clearmessage",f)}else{var R=w(t);this.emit("clearchat",R)}else{var P=w(t);this.emit("usernotice",P)}else{var b=w(t);this.emit("notice",b)}}else{var C=u(t);this.emit("part",{channel:C})}else{var T=u(t);this.emit("join",{channel:T})}}else{var y=function(e){var t=e.raw,r=e.trailing,n=e.tags,s=e.prefix.name,a=m(r);return{raw:t,message:a?c(r):r,channel:u(e),user:s,get tags(){return v(n)},isAction:a}}(t);this.emit("message",y)}},p._connectInNode=function(){var e=this,n="irc.chat.twitch.tv",s=this.options.secure?6697:6667;return new Promise((function(a,i){e._connecting=!0;var o=function(){e._connecting=!1,e._connected=!0,e.emit("connect"),a()};e.options.secure?e.socket=t.connect(s,n,{},o):(e.socket=new r.Socket,e.socket.connect(s,n,o)),e.socket.on("error",(function(t){e._connected=!1,e._connecting=!1,e.emit("disconnect",t),i(t)})),e.socket.on("data",(function(t){e.receiveRaw(t.toString())})),e.socket.on("close",(function(){e._connected=!1,e._connecting=!1,e._registered=!1,e.emit("disconnect")}))}))},p._connectInBrowser=function(){var e=this,t=this.options.secure?"wss://irc-ws.chat.twitch.tv:443":"ws://irc-ws.chat.twitch.tv:80";return new Promise((function(r,n){e._connecting=!0,e.socket=new WebSocket(t),e.socket.onopen=function(){e._connected=!0,e._connecting=!1,e.emit("connect"),r()},e.socket.onmessage=function(t){return e.receiveRaw(t.data)},e.socket.onerror=function(){},e.socket.onclose=function(t){var r=t.wasClean,s=t.code,a=t.reason;if(e.socket=null,e._connected=!1,e._connecting=!1,e._registered=!1,r)e.emit("disconnect");else{var i=new Error("["+s+"] "+a);e.emit("disconnect",i),n(i)}}}))},p._register=function(){var e=this;if(!this._connected)return Promise.reject();if(this._registered)return Promise.resolve();var t=this.options,r=t.auth,n=t.name||o(),s=r?"oauth:"+r:"SCHMOOPIIE";return this.sendRaw("CAP REQ :twitch.tv/tags twitch.tv/commands"),this.sendRaw("PASS "+s),this.sendRaw("NICK "+n),new Promise((function(t,r){var n=function r(){t(),e.off("register",r)};e.on("register",n),setTimeout((function(){r(),e.off("register",n)}),1e4)}))},p._updateGlobalUserState=function(e){this.globalUserState=a({},this.globalUserState,{},e)},p._updateUserState=function(e,t){var r;this.channels=a({},this.channels,((r={})[e]=a({},this.channels[e],{userState:t}),r))},p._updateRoomState=function(e,t){var r;this.channels=a({},this.channels,((r={})[e]=a({},this.channels[e],{roomState:t}),r))},(l=[{key:"connected",get:function(){return this._connected}},{key:"connecting",get:function(){return this._connecting}},{key:"registered",get:function(){return this._registered}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(g.prototype,l),g}(n.EventEmitter);(R=exports.UserNoticeType||(exports.UserNoticeType={})).sub="sub",R.resub="resub",R.subgift="subgift",R.anonsubgift="anonsubgift",R.submysterygift="submysterygift",R.giftpaidupgrade="giftpaidupgrade",R.rewardgift="rewardgift",R.anongiftpaidupgrade="anongiftpaidupgrade",R.raid="raid",R.unraid="unraid",R.ritual="ritual",R.bitsbadgetier="bitsbadgetier",exports.Client=P,exports.getChannelFromMessage=u,exports.getIsAction=m,exports.getRandomUsername=o,exports.isNode=d,exports.normalizeActionMessage=c,exports.parseMessageTags=v;
//# sourceMappingURL=twitch-simple-irc.cjs.production.min.js.map
